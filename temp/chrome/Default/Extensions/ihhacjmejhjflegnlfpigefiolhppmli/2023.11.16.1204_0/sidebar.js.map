{"version":3,"file":"sidebar.js","mappings":"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","sources":["webpack://metamate/./src/options.ts","webpack://metamate/./src/sidebar.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nexport function getOptions() {\n    return __awaiter(this, void 0, void 0, function* () {\n        return (yield chrome.storage.sync.get({\n            hostOverride: null,\n        }));\n    });\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { getOptions } from \"./options\";\nfunction setUpSidebar(iframe) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n        const options = yield getOptions();\n        const data = yield chrome.storage.sync.get(\"lastConversationId\");\n        const lastConversationId = (_a = data.lastConversationId) !== null && _a !== void 0 ? _a : \"\";\n        let host;\n        if (options.hostOverride != null && options.hostOverride !== \"\") {\n            host = `www.${options.hostOverride}.internalfb.com`;\n        }\n        else {\n            host = \"www.internalfb.com\";\n        }\n        iframe.src = `https://${host}/metamate_chrome/${lastConversationId}`;\n    });\n}\nconst clearWarning = setTimeout(() => {\n    var _a;\n    (_a = document.querySelector(\"#warning\")) === null || _a === void 0 ? void 0 : _a.classList.remove(\"hidden\");\n}, 5000);\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    var _a;\n    const iframe = document.querySelector(\"#iframe\");\n    setUpSidebar(iframe)\n        .then(() => { })\n        .catch(() => { });\n    (_a = document.querySelector(\"#close-warning\")) === null || _a === void 0 ? void 0 : _a.addEventListener(\"click\", (e) => {\n        var _a;\n        e.preventDefault();\n        (_a = document.querySelector(\"#warning\")) === null || _a === void 0 ? void 0 : _a.classList.add(\"hidden\");\n    });\n});\nfunction getCurrentTab() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const queryOptions = { active: true, lastFocusedWindow: true };\n        const [tab] = yield chrome.tabs.query(queryOptions);\n        return tab;\n    });\n}\nconst ALLOWED_DOMAIN = [\n    \".internalfb.com\",\n    \"fb.workplace.com\",\n    \"docs.google.com\",\n];\nfunction isUrlAllowed(url) {\n    for (const domain of ALLOWED_DOMAIN) {\n        if (url.hostname.endsWith(domain)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction reply(source, message, origin) {\n    // Hack: TypeScript's typecheck fails here to see the second parameter can be a string.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\n    source.postMessage(message, origin);\n}\n// Only trust messages from internalfb.com.\nfunction validateOrigin(origin) {\n    const originAsURL = new URL(origin);\n    return (originAsURL.protocol === \"https:\" &&\n        originAsURL.hostname.endsWith(\".internalfb.com\"));\n}\nfunction handleMessages(event) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!validateOrigin(event.origin)) {\n            return;\n        }\n        const data = event.data;\n        if (data.action === \"GetActiveUrl\") {\n            const tab = yield getCurrentTab();\n            if ((tab === null || tab === void 0 ? void 0 : tab.url) == null) {\n                return;\n            }\n            if (isUrlAllowed(new URL(tab.url)) && event.source != null) {\n                reply(event.source, { action: \"ReplyActiveUrl\", url: tab.url, title: (_a = tab.title) !== null && _a !== void 0 ? _a : null }, event.origin);\n            }\n        }\n        else if (data.action === \"UpdateConversationId\" &&\n            typeof data.conversationId !== \"undefined\") {\n            const { conversationId } = data;\n            chrome.storage.sync.set({ lastConversationId: conversationId }, () => { });\n        }\n        else if (data.action === \"MetamateLoaded\") {\n            clearTimeout(clearWarning);\n            (_b = document.querySelector(\"#warning\")) === null || _b === void 0 ? void 0 : _b.classList.add(\"hidden\");\n        }\n    });\n}\nwindow.addEventListener(\"message\", (event) => {\n    handleMessages(event).catch((e) => {\n        console.error(e);\n    });\n});\n"],"names":["thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","setUpSidebar","iframe","_a","this","options","chrome","storage","sync","get","hostOverride","getOptions","data","lastConversationId","host","src","clearWarning","setTimeout","document","querySelector","classList","remove","addEventListener","catch","preventDefault","add","ALLOWED_DOMAIN","window","event","_b","origin","originAsURL","URL","protocol","hostname","endsWith","validateOrigin","action","tab","tabs","query","active","lastFocusedWindow","getCurrentTab","url","domain","isUrlAllowed","source","message","title","postMessage","conversationId","set","clearTimeout","handleMessages","console","error"],"sourceRoot":""}
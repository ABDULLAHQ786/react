(()=>{"use strict";async function n(n){var t;return(await(t=[n],new Promise((n=>chrome.storage.local.get(t,n)))))[n]}async function t(n,t){return await(e={[n]:t},new Promise((n=>chrome.storage.local.set(e,n))));var e}function e(n){return"https://internalfb.com/intern"+n}const r=e("/api/dtsg/internal"),o="oneoneext/settings/csrftoken/v1";let l=null,a=null;function i(){const e=Date.now()/1e3;return(null===l||a<=e)&&(l=async function(){const e=await n(o),l=Date.now()/1e3+60;if(null!=e&&e.expire>=l)return e.token;const a=await fetch(r);if(200!==a.status)return console.warn("Failed GraphQL fetch. Status Code: "+a.status),null;const i=await a.text();if(null==i)return console.warn("Failed to get CSRF token"),null;const s=JSON.parse(i.slice(9));return await t(o,s),s.token}(),a=e+7200),l}function s(n,t){return new Promise((function(e,r){let o=new XMLHttpRequest;o.open("POST",n),o.responseType="",o.onerror=function(){r(new Error("error"))},o.onload=function(){let n=o.response;e(n)},o.send(t)}))}function c(n,t){return i().then((r=>{let o=e("/api/graphql?doc_id="+n);return t&&(o+="&variables="+encodeURIComponent(JSON.stringify(t))),o+="&fb_dtsg="+r+"&__a=1",s(o)})).then((t=>{let e={};try{e=JSON.parse(t)}catch{return console.warn(`Failed GraphQL fetch (DocID: ${n}). Error: %s`,t),null}return e.error?(console.warn("Failed GraphQL fetch. Status Code: "+e.error),null):null!=e?e.data:null}))}async function u(n,t){return i().then((r=>{let o=e("/api/graphql?doc_id="+n);return t&&(o+="&variables="+encodeURIComponent(JSON.stringify(t))),o+="&fb_dtsg="+r+"&__a=1",s(o)})).then((t=>{let e={};try{e=JSON.parse(t)}catch{return console.warn(`Failed GraphQL fetch (DocID: ${n}). Error: %s`,t),null}return e.error?(console.warn("Failed GraphQL fetch. Status Code: "+e.error),null):null!=e?e.data:null}))}const d=chrome.runtime.getManifest().version;const f=/fb\.workplace\.com\/groupcall\/LINK:([a-z]+)/;chrome.runtime.onInstalled.addListener((n=>{!function(n){let{event:t,action:e,payload:r}=n;c("2898669936911188",{input:{event:t,action:e,version:d,log_payload:r}})}({event:"IA_ACTION_ONE_ONE_CHROME_EXTENSION_INSTALLED"})})),chrome.tabs.onActivated.addListener((function(n){const t=null===n||void 0===n?void 0:n.tabId;null!=t&&chrome.tabs.get(t,(function(n){const t=(null===n||void 0===n?void 0:n.url)||(null===n||void 0===n?void 0:n.pendingUrl);null!=t&&function(n){if(null==n)return;const t=n.match(f);if(null==t)return;null!=t[1]&&u("4590842820927092",{uri:n}).then((n=>{var t;null!==n&&void 0!==n&&null!==(t=n.one_one_extension_root)&&void 0!==t&&t.can_show_notification_upsell&&(chrome.notifications.create("upsell",{iconUrl:"1_1.png",title:"Try the 1:1 Tool!",message:"Hit Alt+Shift+O to take notes in a shared agenda during your 1:1 with this person.",type:"basic"}),u("2841564069287171",{input:{nux_type:"ONE_ONE_CHROME_EXTENSION_NOTIFICATION_UPSELL"}}))}))}(t)}))}))})();
//# sourceMappingURL=background.js.map
!function(){"use strict";var n=function(n,e,t,o){return new(t||(t=Promise))((function(r,i){function c(n){try{s(o.next(n))}catch(n){i(n)}}function a(n){try{s(o.throw(n))}catch(n){i(n)}}function s(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(c,a)}s((o=o.apply(n,e||[])).next())}))};function e(e){var t;return n(this,void 0,void 0,(function*(){const n=yield function(){return n=this,e=void 0,o=function*(){return yield chrome.storage.sync.get({hostOverride:null})},new((t=void 0)||(t=Promise))((function(r,i){function c(n){try{s(o.next(n))}catch(n){i(n)}}function a(n){try{s(o.throw(n))}catch(n){i(n)}}function s(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(c,a)}s((o=o.apply(n,e||[])).next())}));var n,e,t,o}(),o=yield chrome.storage.sync.get("lastConversationId"),r=null!==(t=o.lastConversationId)&&void 0!==t?t:"";let i;i=null!=n.hostOverride&&""!==n.hostOverride?`www.${n.hostOverride}.internalfb.com`:"www.internalfb.com",e.src=`https://${i}/metamate_chrome/${r}`}))}const t=setTimeout((()=>{var n;null===(n=document.querySelector("#warning"))||void 0===n||n.classList.remove("hidden")}),5e3);document.addEventListener("DOMContentLoaded",(()=>{var n;e(document.querySelector("#iframe")).then((()=>{})).catch((()=>{})),null===(n=document.querySelector("#close-warning"))||void 0===n||n.addEventListener("click",(n=>{var e;n.preventDefault(),null===(e=document.querySelector("#warning"))||void 0===e||e.classList.add("hidden")}))}));const o=[".internalfb.com","fb.workplace.com","docs.google.com"];window.addEventListener("message",(e=>{(function(e){var r,i;return n(this,void 0,void 0,(function*(){if(!function(n){const e=new URL(n);return"https:"===e.protocol&&e.hostname.endsWith(".internalfb.com")}(e.origin))return;const c=e.data;if("GetActiveUrl"===c.action){const t=yield function(){return n(this,void 0,void 0,(function*(){const[n]=yield chrome.tabs.query({active:!0,lastFocusedWindow:!0});return n}))}();if(null==(null==t?void 0:t.url))return;(function(n){for(const e of o)if(n.hostname.endsWith(e))return!0;return!1})(new URL(t.url))&&null!=e.source&&(a=e.source,s={action:"ReplyActiveUrl",url:t.url,title:null!==(r=t.title)&&void 0!==r?r:null},u=e.origin,a.postMessage(s,u))}else if("UpdateConversationId"===c.action&&void 0!==c.conversationId){const{conversationId:n}=c;chrome.storage.sync.set({lastConversationId:n},(()=>{}))}else"MetamateLoaded"===c.action&&(clearTimeout(t),null===(i=document.querySelector("#warning"))||void 0===i||i.classList.add("hidden"));var a,s,u}))})(e).catch((n=>{console.error(n)}))}))}();
//# sourceMappingURL=sidebar.js.map